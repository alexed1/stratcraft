<aura:component implements="flexipage:availableForAllPageTypes, force:appHostable" access="global" controller="StrategyCrafterController">
    
    <ltng:require scripts="{!$Resource.force}" />
    <ltng:require scripts="{!$Resource.strategy}" />
    <ltng:require scripts="{!$Resource.utils}" />
    <!-- 
    <ltng:require scripts="{!$Resource.hopscotch}" afterScriptsLoaded="{!c.hopscotchLoaded}" />
    <ltng:require scripts="{!$Resource.hopscotchcss}" />
    <ltng:require scripts="{!$Resource.hopscotchspritegreen}" />
    <ltng:require scripts="{!$Resource.hopscotchspriteorange}" />
    -->

    <aura:attribute name="currentStrategy" type="Object" />
    <aura:attribute name="originalNode" type="Object" />
    <aura:attribute name="isTreeView" type="Boolean" default="true" />

    <aura:attribute name="strategyNames" type="List" />
    <aura:attribute name="selectedStrategyName" type="String" default="" />

    <aura:handler name="change" value="{!v.selectedStrategyName}" action="{!c.handleStrategySelection}" />
    <aura:handler name="init" value="{!this}" action="{!c.init}" />

    <aura:handler event="c:propertyPageSaveRequestEvent" action="{!c.saveStrategy}" />
    <aura:handler event="c:nodeDeletionRequestedEvent" action="{!c.handleNodeDeletionRequested}" />
    <aura:handler event="c:treeNodeSelectedEvent" action="{!c.handleTreeNodeSelect }" />
    <aura:handler event="c:nodeDataRequestEvent" action="{!c.handleNodeDataRequest}" />
    <aura:handler event="c:newNodeCreationRequestedEvent" action="{!c.handleNewNodeCreationRequested}" />

    <div class="slds-card slds-p-around_small">

        <lightning:spinner aura:id="mySpinner" class="slds-hide" size="large" />

        <lightning:overlayLibrary aura:id="modalDialog" />

        <div class="slds-float_left slds-m-top_large">

            <lightning:buttonMenu iconName="utility:settings" alternativeText="Settings" onselect="{!c.handleMenuSelect}">
                <lightning:menuItem label="New Strategy" value="newStrategy" />                
                <aura:if isTrue="{!v.selectedStrategyName != ''}">
                    <hr class="myhr" />
                    <lightning:menuItem label="New Node" value="addElement" />                          
                    <lightning:menuItem label="Save Strategy" value="saveStrategy" />
                </aura:if>  
            </lightning:buttonMenu>
        </div>
        <div class="slds-float_left slds-m-top_xxx-small slds-m-left_small">

            <lightning:select name="strategySelect" label="Select a strategy:" aura:id="mySelect" value="{!v.selectedStrategyName}" class="select_box">
                <aura:iteration items="{!v.strategyNames}" var="item">
                    <option text="{!item}" value="{!item}" />
                </aura:iteration>
            </lightning:select>

        </div>
        <div class="slds-float_left slds-m-left_small slds-m-bottom_x-small slds-grid slds-m-top_large slds-grid_vertical-align-center">
            <div class="slds-col">
                <p>Graph</p>
            </div>
            <div class="slds-col slds-m-horizontal_x-small">
                <lightning:input type="toggle" messageToggleActive="" messageToggleInactive="" checked="{!v.isTreeView}" /> 
            </div>
            <div class="slds-col">
                <p>Tree</p>
            </div>                         
        </div>
        <p />
        <hr class="myhr"></hr>

        <!-- <div aura:id="fileInput" ondragover="{!c.onDragOver}" ondrop="{!c.onDrop}" >Drop Here!</div> -->
        <br />
        <aura:if isTrue="{!v.isTreeView}">            
            <div class="slds-grid">
                <div class="slds-col slds-box slds-size_1-of-3">
                    <c:treeNode aura:id="tree"  header="NodeTree" />
                </div>    
                <div class="slds-col slds-box">
                    <b>Node Properties</b>
                    {!v.body}
                    <c:basePropertyPage aura:id="propertyPage" currentStrategy="{!v.currentStrategy}" />
                </div>    
            </div>
            <aura:set attribute="else">
                <div id="graphContainer">
                    <p>Graph view placeholder</p>
                </div>
            </aura:set>
        </aura:if>
    </div>

</aura:component>